<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Services - pymsgbus</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Services";
        var mkdocs_page_input_path = "services.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> pymsgbus
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../types/">Definitions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../pubsub/">Publisher and Subscribers</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../events/">Producers and Consumers</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Services</a>
    <ul class="current">
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../sessions/">Unit Of Work</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">pymsgbus</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Services</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h3 id="modeling-the-service-layer-with-commands-and-queries">Modeling the service layer with commands and queries.</h3>


<div class="doc doc-object doc-module">



<a id="pymsgbus.service"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="pymsgbus.service.Service" class="doc doc-heading">
            <code>Service</code>


</h2>


    <div class="doc doc-contents ">


        <p>A SERVICE is the technical authority for a business capability. And it is the exclusive
owner of a certain subset of the business data.  It centralizes and organizes domain
operations, enforces business rules, and coordinates workflows. </p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pymsgbus.service.Service.register" href="#pymsgbus.service.Service.register">register</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Registers a handler for a specific command or query type. Handles nested or generic annotations.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pymsgbus.service.Service.handler" href="#pymsgbus.service.Service.handler">handler</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Decorator for registering a function as a handler for a command or query type.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pymsgbus.service.Service.handle" href="#pymsgbus.service.Service.handle">handle</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Executes the handler associated with the given command or query.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>
        <p>Example:</p>
<pre><code>.. code-block:: python
from dataclasses import dataclass
from pymsgbus import Service
from pymsgbus.models import Command, Query

@dataclass
class CreateUser(Command):
    id: str
    name: str

@dataclass
class UpdateUser(Command):
    id: str
    name: str

@dataclass
class QueryUser(Query):
    id: str

@dataclass
class User:
    id: str
    name: str

service = Service() # Define a new service
db = {}

@service.handler
def handle_put_user(command: CreateUser[str] | UpdateUser):
    db[command.id] = command.name

@service.handler
def handle_query_user(query: QueryUser) -&gt; User: # Performs pydantic validation
    return User(id=query.id, name=db.get(query.id))

service.handle(CreateUser(id='1', name='Alice'))
service.handle(UpdateUser(id='1', name='Bob'))
user = service.handle(QueryUser(id='1'))
assert user.name == 'Bob'
assert user.id == '1'
</code></pre>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pymsgbus.service.Service.__init__" class="doc doc-heading">
            <code class="highlight language-python">__init__(name=None, cast=True, provider=None, generator=lambda name: name, validator=lambda type, payload: type(**payload))</code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes a new instance of the Subscriber class.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>name</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the subscriber. Defaults to None.</p>
              </div>
            </li>
            <li>
              <b><code>cast</code></b>
                  (<code>bool</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>Casting dependencies during dependency injection. Defaults to True.</p>
              </div>
            </li>
            <li>
              <b><code>provider</code></b>
                  (<code><span title="pymsgbus.depends.Provider">Provider</span></code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>. The dependency provider for dependency injection. Defaults to None.</p>
              </div>
            </li>
            <li>
              <b><code>generator</code></b>
                  (<code><span title="typing.Callable">Callable</span>[[str], str]</code>, default:
                      <code>lambda name: <span title="pymsgbus.service.Service.name">name</span></code>
)
              –
              <div class="doc-md-description">
                <p>The generator function for generating the handler key. Defaults to lambda name: name.</p>
              </div>
            </li>
            <li>
              <b><code>validator</code></b>
                  (<code><span title="typing.Callable">Callable</span>[[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>], <span title="typing.Any">Any</span>]</code>, default:
                      <code>lambda type, payload: type(**payload)</code>
)
              –
              <div class="doc-md-description">
                <p>The validator function for validating the payload. Defaults to lambda type, payload: type(**payload).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pymsgbus.service.Service.execute" class="doc doc-heading">
            <code class="highlight language-python">execute(action, payload)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Executes the handler associated with the given request action and it's payload. It validates the payload
asoociated with the action using the validator function provided by the user. The validator function defaults
to the constructor of the action class. If you are using a validation library like pydantic, you can override
the validator function to use the pydantic model_validate function.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>action</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>to be handled</p>
              </div>
            </li>
            <li>
              <b><code>payload</code></b>
                  (<code><span title="typing.Any">Any</span></code>)
              –
              <div class="doc-md-description">
                <p>the payload to be passed to the handler</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
    The result of the handler function, if any.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="pymsgbus.exceptions.TypeNotFound">TypeNotFound</span></code>
              –
              <div class="doc-md-description">
                <p>If no action is registered for the given command or query type.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pymsgbus.service.Service.handle" class="doc doc-heading">
            <code class="highlight language-python">handle(request)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Handles a request by executing the handler associated with the request type. The handler is determined by the
generator function provided by the user.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>request</code></b>
                  (<code><span title="typing.Any">Any</span></code>)
              –
              <div class="doc-md-description">
                <p>The request to be handled. The name of the request class is used to determine the handler to be handled</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="pymsgbus.exceptions.HandlerNotFound">HandlerNotFound</span></code>
              –
              <div class="doc-md-description">
                <p>If no handler is registered for the given request type.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>Any</code></b>(                  <code><span title="typing.Any">Any</span></code>
)              –
              <div class="doc-md-description">
                <p>The result of the handler function.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pymsgbus.service.Service.handler" class="doc doc-heading">
            <code class="highlight language-python">handler(wrapped)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Decorator for registering a function as a handler for a a given request type.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>wrapped</code></b>
                  (<code><span title="typing.Callable">Callable</span>[..., <span title="typing.Any">Any</span>]</code>)
              –
              <div class="doc-md-description">
                <p>The function to be registered as a handler.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Callable">Callable</span>[..., <span title="typing.Any">Any</span>]</code>
              –
              <div class="doc-md-description">
                <p>The original function, unmodified.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pymsgbus.service.Service.on" class="doc doc-heading">
            <code class="highlight language-python">on(exception_type)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Decorator for registering a handler for a given exception type. The handler is called when an exception of
the given type is raised.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>exception_type</code></b>
                  (<code>type[Exception]</code>)
              –
              <div class="doc-md-description">
                <p>The type of the exception to be handled.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              –
              <div class="doc-md-description">
                <p>The handler function.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pymsgbus.service.Service.register" class="doc doc-heading">
            <code class="highlight language-python">register(annotation, handler)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Register a handler for a given annotation. This method is called recursively to handle nested annotations.
Don't call this method directly, use the handler decorator instead. This method is called by the handler decorator.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>annotation</code></b>
                  (<code><span title="typing.Any">Any</span></code>)
              –
              <div class="doc-md-description">
                <p>The annotation to be registered.</p>
              </div>
            </li>
            <li>
              <b><code>handler</code></b>
                  (<code><span title="typing.Callable">Callable</span></code>)
              –
              <div class="doc-md-description">
                <p>The handler to be registered.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pymsgbus.service.Service.validate" class="doc doc-heading">
            <code class="highlight language-python">validate(type, payload)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Validate the payload associated with the given type. The type is used to determine the validator function to be used.
The validator function defaults to the constructor of the type class. If you are using a validation library like pydantic,
you can override the validator function to use the pydantic model_validate function.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>type</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The type of the payload to be validated.</p>
              </div>
            </li>
            <li>
              <b><code>payload</code></b>
                  (<code><span title="typing.Any">Any</span></code>)
              –
              <div class="doc-md-description">
                <p>The payload to be validated.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="pymsgbus.exceptions.TypeNotFound">TypeNotFound</span></code>
              –
              <div class="doc-md-description">
                <p>If no handler is registered for the given type.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              –
              <div class="doc-md-description">
                <p>The validated payload as an instance of the type class.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../events/" class="btn btn-neutral float-left" title="Producers and Consumers"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../sessions/" class="btn btn-neutral float-right" title="Unit Of Work">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../events/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../sessions/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
